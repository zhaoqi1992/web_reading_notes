#前端对网站性能的影响
##黄金法则
* 只有20%的用户响应时间花费在下载HTML文档。其余的80%~90%时间花在下载页面中所有组件上。
## 性能优化建议  
####优先级从高到低
### 1.减少HTTP请求
### 2.使用内容发布网络
### 3.添加Expires首部
### 4.压缩组件
### 5.将样式表放在顶部
### 6.将脚本放在底部
### 7.避免CSS表达式
### 8.使用外部javascript和CSS
### 9.减少DNS查找
### 10.精简javascript
### 11.避免重定向
### 12.删除重复脚本
### 13.配置ETag
### 14.使Ajax可缓存
***
### 1.减少HTTP请求
* 图片地图
	* 在一个图片上关联多个URL
		* 服务器图片地图
			* 把所有点击提交到同一个URL，并通过传递用户点击位置，映射不同的操作
		* 客户端图片地图
			* ``<img usename='mymap'><map name='mymap'><area shape='rect' coords'0,0,31,31' href='home.html'></map>``
				* coords规定了area的范围
* CSS Sprites
	* 最佳方式
	* 把图片整合到一张图上，通过background-position选择需要的部分
		* 还可以降低下载量
* 内联图片
	* 把图片变成编码的形式
		* data:URL
		* data:img/gif;based64,具体编码
		* <IE7不支持
		* 图片大小受限制，based64编码可能会增加图片大小，加大下载量
		* 内联在页面内，跨越不同的页面不会被缓存
			* 写在外部CSS中，作为元素背景
* 合并脚本和样式表
	* 开发网页的时候组件分开写，发布的时候合并在一起
### 2.使用内容发布网络
* 内容发布网络
	* web服务器离用户更近，加载速度越快；组件WEB服务器离用户更近，多个HTTP响应时间变短
	* web组件服务器分散开
		* CDN一组分在不同地理位置的web服务器
		* 优点
			* 减少HTTP请求，加快加载速度
			* 缓解流量峰值的压力
		* 缺点
			* CDN是公用的，可能会受到同一个web服务器组上的网站的影响
### 3.添加Expires首部
* Epires头
	* 缓存的有效期，在该日期之前都用缓存
		* 浏览器和服务器的时钟不同步将造成问题
* Max-Age和mod_expires
	* max-age
		* http1.1，cache-control
		* 从组件被请求开始，过去的秒数小于max-age，就使用缓存版本
	* mod_expires
		* Apache模块，通过Expires-Default指令设置：自请求开始多长时间内用缓存版本。
			* 同时向响应中发送，Expires,Catch-control max-age
* 空缓存和完整缓存
	* 缓存针对于用户再次访问时加载速度的优化
	* 尽可能的使用缓存
* 不仅仅是图片
	* 不经常变化的组件尽可能缓存
* 修订文件名
	* 缓存到期之前需要更新，修改组件的文件名，浏览器自然会从新下载组件
### 4.压缩组件
* 压缩HTTP响应的大小
* 客户端：Accepy-Encoding:gzip
	* 服务器：Content-Encoding:gzip
* 压缩什么
	* html,css,js
	* 不要压缩图片和pdf
* 节省
	* 数据量可以减少70%
* 配置
	* 针对Apache的配置
* 代理缓存
	* 服务器响应中添加Vary头，告诉代理根据不同的请求头缓存不同的响应
	* Vary:Accept-Encoding
* 边缘情形
	* 通过浏览器白名单，只为支持压缩的浏览器发送压缩的内容
	* 代理缓存
		* Vary:Accept-Encoding,User-Agent
			* 服务器不和代理共享浏览器白名单
	* 禁用代理缓存
		* 在访问量非常大的时候，建议禁用缓存
			* Vary:*
			* Cache-Control:private
		* 禁用ETag
### 5.将样式表放在顶部
* 逐步呈现
	* 样式表放到顶部主要是为了逐步呈现页面提供可视化回馈
	* 浏览器是按照组件在文档中的顺序下载的
	* 将样式表放到文档底部可以避免重绘页面中的元素
	* 样式表放在底部是可视化组件加载更快的方式
* 白屏
	* 页面完全空白，等待样式表加载后，绘制元素，一起涌上页面
		* 尽量不要用@import，@import会导致组件下载的无序性，可能会造成白屏
	* 发生在这些情况下
		* 新窗口中加载页面
		* 重新加载
		* 作为主页，刚打开浏览器时
* 无样式内容的闪烁（FOUC）
	* 对于同一个元素，后面的样式覆盖前面的样式会导致元素需要重新绘制
	* 发生在这些情况下
		* 点击链接
		* 使用书签
		* 键入URL
	* 白屏实际上是浏览器对无样式内容的闪烁的一种补偿策略
		* 逐步呈现就有闪烁的风险
* 样式表放在``<head>``可以同时避免白屏和FOUC
### 6.将脚本放在底部
* 脚本带来的问题
	* 阻塞并行下载
	* 位于脚本以下的内容，逐步呈现都受到阻塞
* 并行下载
	* 浏览器并行的执行HTTP请求
	* HTTP1.1规定，浏览器从一个主机名并行的下载两个组件
		* 可以通过CNAME(DNS)把组价分别放到多个主机名中
			* 使用两个主机名性能最好
* 脚本阻塞下载
	* 下载脚本的时候禁止并行下载
		* 可能脚本中存在document.write改变文档内容
		* 保证脚本按照正确的顺序执行
### 7.避免CSS表达式
*IE中的问题，别的浏览器会自动忽略CSS表达式
### 8.使用外部javascript和CSS
* 内联和外置
* 典型的对比结果
* 主页
* 两全其美
### 9.减少DNS查找
* DNS和TTL
* 浏览器的视角
* 减少DNS查找
### 10.精简javascript
* 精简
* 混淆
* 节省
* 实例
* 锦上添花
### 11.避免重定向
* 重定向类型
* 重定向如何损伤性能
* 重定向之外的选择
### 12.删除重复脚本
* 重复脚本损伤性能
* 避免重复脚本
### 13.配置ETag
* ETag是什么
* ETag带来的问题
* 用还是不用ETag
* 现实世界中的ETag
### 14.使Ajax可缓存
* web2.0、DHTML和AJAX
* 异步和即时
* 优化ajax请求